# Tune Tracker

For my final project, I built a web application that provides access to a user's Spotify listening data, allowing them to gain some insight about the artists and tracks that they've listened to most often, and how their listening behavior has changed over time. It was inspired by [Spotify Wrapped](https://newsroom.spotify.com/2019-12-05/spotify-wrapped-2019-reveals-your-streaming-trends-from-2010-to-now/) - the deep dive into your listening history that Spotify provides at the end of each year. I wanted to build something that would provide similar analysis that you can access any time you want. I'm really happy with what I was able to get from the Spotify API and with how the final product turned out. 

Here's the link to my site, which is deployed on surge: [Tune Tracker](http://tunetracker.surge.sh/)

And here's a little video I put together that shows off all the functionality: [demo](https://vimeo.com/user113969829/review/459585102/d3056eb9cf)

## Features

There are five routes in the navbar, each corresponding to a different view / React component that provides a number of features.

**Top Artists:** This displays the user's top artists (up to 50) for three different time ranges: all time, past 6 months, and past month. On the page you can filter between the three time ranges, click on any artist link to open the artist page in Spotify, or click a button to create a playlist. This takes the top 5 tracks on Spotify from the top 20 artists for that time range and creates a playlist based on those tracks, displaying the cover image for the new playlist and a link to open it in Spotify. 

**Top Tracks:** This is pretty similar to top artists. It displays the user's top tracks (again up to 50) for the same three time ranges, and likwise allows the user to click to open a track in Spotify or create a playlist based on this tracks. In this case, creating a playlist is simpler - it just takes the tracks you seen on screen and puts those into a new playlist.

**Recent Tracks:** This tab shows the user's 50 most recently played tracks, along with the date and time that the user listened to the track. You can sort by Most Recent or Chronological (reverse of most recent) and as usual, click to open tracks or to create a playlist.

**Artists Analysis:** This tab takes the user's top artists for the three time ranges and does some comparisons between them. The first is called *Deep Cuts*, which shows the artists that appear in the user's top artists of all time, but not in their top artists for any other timerange. The second is called *On Repeat*, which shows the artists that appear in the user's top artists for the past month as well as the past 6 months. And finally, there's *Consistent Favorites,* which shows the artists that appear in the user's top artists of all time, as well as in their top artists from the past 6 months or the past month. The three comparisons are displayed side by side in three columns, and as usual, you can click on any artist to open their page in Spotify, or create a playlist based on any of the three comparisons.

**Tracks Analysis:** The last tab is called Tracks Analysis, which is very similar to Artists Analysis. The three comparisons are the same, only this time we also compare against recently played tracks. *Deep Cuts* displays tracks that appear in the user's top track tracks of all time but in none of the other three categories (past 6 months, past month, or recently played). *On Repeat* shows tracks that appear in the user's top tracks from the past month and recently played tracks. And *Consistent Favorites* shows tracks that appear in the user's top tracks of all time and in one of the other three categories.

## Architecture 

To access the Spotify API, I needed to first register my app with Spotify. This provided a client ID for my app, and allowed me to set the redirect URI for authentication (where the user is taken to after they authenticate on Spotify). Both of these are in my config file, as well as the scopes for accessing the specific Spotify API endpoints that I needed for the application. Once the user authenticates, the application gets their OAuth token, which is used in every Spotify API call. I used a really helpful online tutorial to set up authentication on the app, which is referenced in my citations below. Authentication in this case is prety limited. The tutorial (and subsequently the app) uses the simplest and most lightweight of Spotify's four authorization flows - the OAuth token only lasts for an hour and there's no refresh token to generate a new one when it expires, and if you refresh the page you have to log in again. That said, given the nature of the application I don't think this is a big limitation - I can't imagine anyone using the app for more than an hour or using it very frequently.

Once the user is authenticated we get to the main app page, where there's an about page that describes the app and a nav bar with 5 different routes, corresponding to the 5 major features  of the app. Each route / feature has its own React component which renders the data for that page. All of the calls to and returns from the Spotify API are handled in Redux, and I used a really helpful js library called spotify-web-api-js (cited below) to handle those calls. Redux also stores information about the state of each page - namely which view is selected (time ranges for tracks and artists, and chronological vs. most recent for recently played). This is used so that the filter the user selected stays selected when they switch back and forth between tabs, and for creating and naming playlists. I also used another js library for the modal, which opens when the user creates a new playlist and shows an image of the created playlist and a link to open it.

## Limitations and Future Work
* The big code specific limitation is in componentDidMount for the Artists Analysis and Tracks Analysis files. Those files run a few Redux actions to fetch the top tracks / artists for each time range, then they run another set of Redux actions to compute the three comparisons based on those tracks/artists. The first actions take time, so right now I have a few setTimeout functions that wait to run the second round of Redux actions. I added enough that it renders as quickly as possible while leaving enough time to make sure that the other functions have returned, so it works - but it's far from the most graceful way to do this. The better way would clearly be to use asychronous js and turn the first Redux actions into promises, but sadly I couldn't figure out how to implement this.
* Error handling could be a lot more robust. I've played around with the app a lot and haven't encountered any errors in the final version (once the app has the token from Spotify it's good to go, and there isn't really anything the user can do to mess things up), but it would be nice to build in some sort of protections and display something for the user if they do run into any errors.
* While I think the way I handled authentication is fine, it would be nice if it were more robust and kept the user logged in.
* It would be nice to have server to handle the Spotify API calls, run them all at once when the user logs in (and then return based on calls to the server, ideally with simplifed and much smaller data structures). Rendering is already pretty fast right now, but it can be a little glitchy when the user opens a new tab for the first time.
* Relatedly, since rendering takes a half second or so the first time around, it would be nice to display a loading gif or something, but I didn't get to add this.
* There were also a few potential features that I didn't get to implement - namely a dashboard displaying an overview of the user's listening behavior, a tab showing top genres or audio features of their top tracks, and some way to share an image of the data that they see on screen (Spotify did this with Wrapped and I remember lots of people posting theirs on Instagram when it came out).

## Citations

I used a lot of different resources and libraries in this project. Small things like Stack Overflow answers are cited inline, but here's a list of some of the big citations that I thought were worth mentioning in the README:
* [Spotify auth tutorial](https://levelup.gitconnected.com/how-to-build-a-spotify-player-with-react-in-15-minutes-7e01991bc4b6): Spotify provides its own server side authentication tutorial which I did, but I decided to make the app client side only (mostly to save time and focus on the frontend features that really interested me, although it does confer that added privacy benefit of not storing user information in a server). This tutorial was really helpful in figuring out how to authenticate, and while I modified it to fit my app, I ended up mostly just using a lot of the code from the tutorial. 
* [spotify-web-api-js](https://github.com/JMPerez/spotify-web-api-js): This is a javascript library that I used this to handle almost all of my calls to the Spotify API. It's a really convenient way to simplify API calls, handling a lot of the orginazational stuff (things like headers) and letting you run simple commands (i.e. get user top tracks for this timerange). This was incredibly helpful and no doubt saved me a ton of time working on the project.
* [react-modal](https://github.com/reactjs/react-modal): I used another library called react-modal for the modal that pops up when you create a new playlist.
* [Scroll to Top](https://stackoverflow.com/questions/36904185/react-router-scroll-to-top-on-every-transition): I ran into an error early on when switching between tabs - if you opened a new tab, it wouldn't open at the top, but instead would start from wherever you scrolled to on the previous tab. I used this code from Stack Overflow to create a component called Scroll to Top (which wraps switch and routes in app.js) that fixed this.
* Last but not least, I got my logo from The Noun Project, which said to include this citation: tune by Ranah Pixel Studio from the Noun Project.
